#!/bin/bash
# Command: project:issue:triage
# Description: Triage a new issue
# Usage: /project:issue:triage <issue_number> <action>
# Actions: duplicate <original_issue>, unclear, invalid, backlog, icebox

ISSUE_NUMBER=$1
ACTION=$2

if [ -z "$ISSUE_NUMBER" ] || [ -z "$ACTION" ]; then
    echo "Usage: /project:issue:triage <issue_number> <action>"
    echo "Actions: duplicate <original_issue>, unclear, invalid, backlog, icebox"
    exit 1
fi

case "$ACTION" in
    "duplicate")
        ORIGINAL=$3
        if [ -z "$ORIGINAL" ]; then
            echo "Error: Please specify the original issue number"
            exit 1
        fi
        gh issue close $ISSUE_NUMBER -c "Duplicate of #$ORIGINAL"
        gh issue edit $ISSUE_NUMBER --add-label "duplicate"
        echo "Issue #$ISSUE_NUMBER closed as duplicate of #$ORIGINAL"
        ;;
        
    "unclear")
        gh issue comment $ISSUE_NUMBER -b "Thank you for reporting this issue. Could you please provide more details about:
- Steps to reproduce the issue
- Expected behavior
- Actual behavior
- Any error messages or logs"
        gh issue edit $ISSUE_NUMBER --add-label "needs-info"
        echo "Requested more information on issue #$ISSUE_NUMBER"
        ;;
        
    "invalid")
        gh issue close $ISSUE_NUMBER -c "This issue doesn't appear to be a bug or valid feature request for this project. If you believe this was closed in error, please provide additional context."
        gh issue edit $ISSUE_NUMBER --add-label "invalid"
        echo "Issue #$ISSUE_NUMBER closed as invalid"
        ;;
        
    "backlog")
        gh issue edit $ISSUE_NUMBER --add-label "status:backlog" --remove-label "status:new-issue"
        echo "Issue #$ISSUE_NUMBER moved to backlog"
        ;;
        
    "icebox")
        gh issue edit $ISSUE_NUMBER --add-label "status:icebox" --remove-label "status:new-issue"
        gh issue comment $ISSUE_NUMBER -b "This is a valid request but not a current priority. We'll keep it in the icebox for future consideration."
        echo "Issue #$ISSUE_NUMBER moved to icebox"
        ;;
        
    *)
        echo "Unknown action: $ACTION"
        echo "Valid actions: duplicate, unclear, invalid, backlog, icebox"
        exit 1
        ;;
esac