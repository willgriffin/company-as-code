# GitHub Actions Workflow Requirements

This document lists all the environment variables, secrets, and repository variables required by the GitHub Actions workflows in this repository.

## Required GitHub Secrets

The following secrets must be configured in **Settings → Secrets and variables → Actions → Repository secrets**:

### DigitalOcean Configuration
- `DIGITALOCEAN_TOKEN` - DigitalOcean API token for managing infrastructure
- `DIGITALOCEAN_SPACES_ACCESS_KEY` - Access key for DigitalOcean Spaces (S3-compatible storage)
- `DIGITALOCEAN_SPACES_SECRET_KEY` - Secret key for DigitalOcean Spaces

### AWS Configuration
- `AWS_ACCESS_KEY_ID` - AWS access key for SES and other services
- `AWS_SECRET_ACCESS_KEY` - AWS secret key for SES and other services
- `AWS_SES_SMTP_USERNAME` - AWS SES SMTP username for email notifications
- `AWS_SES_SMTP_PASSWORD` - AWS SES SMTP password for email notifications

### Application Configuration
- `ADMIN_EMAIL` - Administrator email address for notifications and initial setup
- `DOMAIN` - Primary domain name for the deployment
- `ANTHROPIC_API_KEY` - Anthropic API key for Claude integration

### Optional Secrets
- `OPENAI_API_KEY` - OpenAI API key (optional, for AI integrations)
- `COHERE_API_KEY` - Cohere API key (optional, for AI integrations)

### Auto-Generated Secrets
- `KUBECONFIG` - Kubernetes cluster configuration (automatically set by terraform-deploy workflow)

## Workflow-Specific Requirements

### terraform-deploy.yml
**Required Secrets:**
- `DIGITALOCEAN_TOKEN`
- `DIGITALOCEAN_SPACES_ACCESS_KEY`
- `DIGITALOCEAN_SPACES_SECRET_KEY`
- `AWS_ACCESS_KEY_ID`
- `AWS_SECRET_ACCESS_KEY`

**Environment Variables:**
- `TF_VERSION` - Terraform version (set in workflow)

**Generates:**
- `KUBECONFIG` secret (base64 encoded)

### flux-bootstrap.yml
**Required Secrets:**
- All secrets from terraform-deploy.yml (depends on it)
- `AWS_SES_SMTP_USERNAME`
- `AWS_SES_SMTP_PASSWORD`
- `ADMIN_EMAIL`
- `DOMAIN`
- `KUBECONFIG` (generated by terraform-deploy)

**Optional Secrets:**
- `OPENAI_API_KEY`
- `COHERE_API_KEY`

### claude.yaml
**Required Secrets:**
- `ANTHROPIC_API_KEY`

### create-setup-issue.yml
**Required Secrets:**
- `GITHUB_TOKEN` (automatically provided by GitHub Actions)

## Configuration Files

### Required Files
- `config.yaml` - Main application configuration (copy from `config.yaml.example`)
- `.sops.yaml` - SOPS encryption configuration

### Template Files (Cleaned Up After Setup)
- `.github/workflows/create-setup-issue.yml` - Removed after successful deployment
- `README-TEMPLATE.md` - Removed after successful deployment

## Setup Validation

The `check-setup` action validates:

1. **Required configuration files exist and are customized**
   - `config.yaml` is present and doesn't contain template values
   - `.sops.yaml` is present and doesn't contain template keys

2. **All required GitHub secrets are configured**
   - Infrastructure secrets (DigitalOcean, AWS)
   - Email notification secrets
   - API keys for integrations

3. **No critical template placeholders remain**
   - No `CHANGEME` placeholders in workflow files
   - Configuration files have been properly customized

## How to Configure

1. **Configure GitHub secrets** in repository settings
2. **Copy and customize configuration files:**
   ```bash
   cp config.yaml.example config.yaml
   # Edit config.yaml with your values
   ```
3. **Run the setup script** to finalize configuration:
   ```bash
   ./initial-setup.sh
   ```

## Troubleshooting

### Common Issues
- **Missing secrets:** Check that all required secrets are configured with correct names
- **Template values:** Ensure `config.yaml` doesn't contain `example.com` or `CHANGEME`
- **Permissions:** Verify GitHub Actions has necessary permissions in repository settings

### Validation
Run the check-setup action manually to validate configuration before deployment:
- The action runs automatically before terraform-deploy and flux-bootstrap workflows
- Check the Actions tab for detailed validation results and error messages