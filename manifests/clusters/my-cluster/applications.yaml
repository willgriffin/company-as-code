# Application Flux Kustomizations
---
# AI Gateway (depends on nginx-ingress + oauth2-proxy)
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: ai-gateway
  namespace: flux-system
spec:
  interval: 10m
  path: "./manifests/applications/ai-gateway"
  prune: true
  sourceRef:
    kind: GitRepository
    name: flux-system
  dependsOn:
    - name: nginx-ingress
    - name: oauth2-proxy
  decryption:
    provider: sops
    secretRef:
      name: sops-age
---
# Mattermost (depends on postgresql-operator + dex + nginx-ingress)
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: mattermost
  namespace: flux-system
spec:
  interval: 10m
  path: "./manifests/applications/mattermost"
  prune: true
  sourceRef:
    kind: GitRepository
    name: flux-system
  dependsOn:
    - name: postgresql-operator
    - name: dex
    - name: nginx-ingress
  decryption:
    provider: sops
    secretRef:
      name: sops-age
---
# Nextcloud (depends on postgresql-operator + redis-operator + dex + nginx-ingress)
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: nextcloud
  namespace: flux-system
spec:
  interval: 10m
  path: "./manifests/applications/nextcloud"
  prune: true
  sourceRef:
    kind: GitRepository
    name: flux-system
  dependsOn:
    - name: postgresql-operator
    - name: redis-operator
    - name: dex
    - name: nginx-ingress
  decryption:
    provider: sops
    secretRef:
      name: sops-age
---
# Forgejo (depends on postgresql-operator + dex + nginx-ingress)
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: forgejo
  namespace: flux-system
spec:
  interval: 10m
  path: "./manifests/applications/forgejo"
  prune: true
  sourceRef:
    kind: GitRepository
    name: flux-system
  dependsOn:
    - name: postgresql-operator
    - name: dex
    - name: nginx-ingress
  decryption:
    provider: sops
    secretRef:
      name: sops-age
---
# Homepage (depends on nginx-ingress + oauth2-proxy)
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: homepage
  namespace: flux-system
spec:
  interval: 10m
  path: "./manifests/applications/homepage"
  prune: true
  sourceRef:
    kind: GitRepository
    name: flux-system
  dependsOn:
    - name: nginx-ingress
    - name: oauth2-proxy
