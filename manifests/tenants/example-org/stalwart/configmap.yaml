apiVersion: v1
kind: ConfigMap
metadata:
  name: stalwart-config
  namespace: example-org
data:
  config.toml: |
    # Stalwart Mail Server configuration
    # Replace TEMPLATE_DOMAIN and example-org with your tenant's values

    [server]
    hostname = "mail.example-org.TEMPLATE_DOMAIN"

    [server.listener.smtp]
    bind = "[::]:25"
    protocol = "smtp"

    [server.listener.submission]
    bind = "[::]:587"
    protocol = "smtp"
    tls.implicit = false

    [server.listener.smtps]
    bind = "[::]:465"
    protocol = "smtp"
    tls.implicit = true

    [server.listener.imap]
    bind = "[::]:143"
    protocol = "imap"
    tls.implicit = false

    [server.listener.imaps]
    bind = "[::]:993"
    protocol = "imap"
    tls.implicit = true

    [server.listener.sieve]
    bind = "[::]:4190"
    protocol = "managesieve"

    [server.listener.http]
    bind = "[::]:8080"
    protocol = "http"

    [store.db]
    type = "postgresql"
    url = "%{env:STALWART_DB_URL}%"

    [store.db.pool]
    max-connections = 10

    [storage]
    data = "db"
    blob = "db"
    lookup = "db"
    fts = "db"
    directory = "db"
