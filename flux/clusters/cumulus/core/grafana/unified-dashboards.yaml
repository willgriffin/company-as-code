apiVersion: v1
kind: ConfigMap
metadata:
  name: unified-observability-dashboards
  namespace: grafana
  labels:
    grafana_dashboard: "1"
data:
  application-observability.json: |
    {
      "dashboard": {
        "id": null,
        "title": "Application Observability",
        "tags": ["observability", "unified"],
        "style": "dark",
        "timezone": "browser",
        "refresh": "30s",
        "time": {
          "from": "now-1h",
          "to": "now"
        },
        "panels": [
          {
            "id": 1,
            "title": "Application Metrics Overview",
            "type": "stat",
            "targets": [
              {
                "expr": "up",
                "legendFormat": "{{job}} - {{instance}}",
                "datasource": "Prometheus"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {"mode": "palette-classic"},
                "custom": {"displayMode": "list", "orientation": "auto"},
                "mappings": [],
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": 0},
                    {"color": "green", "value": 1}
                  ]
                }
              }
            },
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0}
          },
          {
            "id": 2,
            "title": "Error Rate",
            "type": "timeseries",
            "targets": [
              {
                "expr": "rate(http_requests_total{status=~\"5..\"}[5m]) / rate(http_requests_total[5m])",
                "legendFormat": "{{service}} Error Rate",
                "datasource": "Prometheus"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {"mode": "palette-classic"},
                "custom": {"drawStyle": "line", "lineInterpolation": "linear"},
                "unit": "percentunit"
              }
            },
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0}
          },
          {
            "id": 3,
            "title": "Request Traces",
            "type": "traces",
            "targets": [
              {
                "query": "service_name=\"your-service\"",
                "datasource": "Jaeger"
              }
            ],
            "gridPos": {"h": 8, "w": 24, "x": 0, "y": 8}
          },
          {
            "id": 4,
            "title": "Application Logs",
            "type": "logs",
            "targets": [
              {
                "expr": "{namespace=\"your-namespace\"}",
                "datasource": "Loki"
              }
            ],
            "gridPos": {"h": 8, "w": 24, "x": 0, "y": 16}
          },
          {
            "id": 5,
            "title": "Sentry Errors",
            "type": "table",
            "targets": [
              {
                "project": "default",
                "datasource": "Sentry"
              }
            ],
            "gridPos": {"h": 8, "w": 24, "x": 0, "y": 24}
          }
        ]
      }
    }
  
  service-map.json: |
    {
      "dashboard": {
        "id": null,
        "title": "Service Map & Dependencies",
        "tags": ["traces", "dependencies"],
        "style": "dark",
        "timezone": "browser",
        "refresh": "1m",
        "time": {
          "from": "now-15m",
          "to": "now"
        },
        "panels": [
          {
            "id": 1,
            "title": "Service Dependencies",
            "type": "nodeGraph",
            "targets": [
              {
                "expr": "sum by (source_service_name, destination_service_name) (rate(traces_service_graph_request_total[5m]))",
                "datasource": "Prometheus"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "custom": {
                  "nodeSize": {
                    "fixed": 20
                  }
                }
              }
            },
            "gridPos": {"h": 16, "w": 24, "x": 0, "y": 0}
          },
          {
            "id": 2,
            "title": "Trace Volume by Service",
            "type": "timeseries",
            "targets": [
              {
                "expr": "sum by (service_name) (rate(traces_total[5m]))",
                "legendFormat": "{{service_name}}",
                "datasource": "Prometheus"
              }
            ],
            "gridPos": {"h": 8, "w": 24, "x": 0, "y": 16}
          }
        ]
      }
    }
  
  infrastructure-overview.json: |
    {
      "dashboard": {
        "id": null,
        "title": "Infrastructure Overview",
        "tags": ["infrastructure", "cluster"],
        "style": "dark",
        "timezone": "browser",
        "refresh": "30s",
        "time": {
          "from": "now-1h",
          "to": "now"
        },
        "panels": [
          {
            "id": 1,
            "title": "Cluster CPU Usage",
            "type": "timeseries",
            "targets": [
              {
                "expr": "100 - (avg by (instance) (irate(node_cpu_seconds_total{mode=\"idle\"}[5m])) * 100)",
                "legendFormat": "{{instance}}",
                "datasource": "Prometheus"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "percent",
                "max": 100,
                "min": 0
              }
            },
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0}
          },
          {
            "id": 2,
            "title": "Cluster Memory Usage",
            "type": "timeseries",
            "targets": [
              {
                "expr": "100 * (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes))",
                "legendFormat": "{{instance}}",
                "datasource": "Prometheus"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "percent",
                "max": 100,
                "min": 0
              }
            },
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0}
          },
          {
            "id": 3,
            "title": "Pod Status",
            "type": "stat",
            "targets": [
              {
                "expr": "kube_pod_status_phase",
                "legendFormat": "{{phase}}",
                "datasource": "Prometheus"
              }
            ],
            "gridPos": {"h": 8, "w": 24, "x": 0, "y": 8}
          }
        ]
      }
    }