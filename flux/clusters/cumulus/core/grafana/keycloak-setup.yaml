apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-keycloak-setup
  namespace: grafana
data:
  instructions: |
    Keycloak Setup Instructions for Grafana Integration
    ==================================================
    
    1. Access Keycloak admin console at https://auth.{{ (datasource "config").domain.primary }}
    
    2. Create a new client for Grafana in the "happyvertical" realm:
       - Client ID: grafana
       - Client Protocol: openid-connect
       - Access Type: confidential
       - Valid Redirect URIs: 
         - https://grafana.{{ (datasource "config").domain.primary }}/oauth2/callback
       - Web Origins: https://grafana.{{ (datasource "config").domain.primary }}
    
    3. Configure client scopes:
       - Default Client Scopes: openid, email, profile
    
    4. Get the client secret from the Credentials tab
    
    5. Update the grafana-oauth2-proxy secret with the actual client secret:
       kubectl edit secret grafana-oauth2-proxy -n grafana
    
    6. Generate a 32-character random cookie secret:
       openssl rand -base64 32 | head -c 32
       Update the cookie-secret in the same secret
    
    Note: OAuth2 Proxy will handle authentication and forward requests
    to Grafana after successful Keycloak authentication.