apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-keycloak-setup
  namespace: prometheus
data:
  instructions: |
    Keycloak Setup Instructions for Prometheus Integration
    =====================================================
    
    1. Access Keycloak admin console at https://auth.{{ (datasource "config").domain.primary }}
    
    2. Create a new client for Prometheus in the "happyvertical" realm:
       - Client ID: prometheus
       - Client Protocol: openid-connect
       - Access Type: confidential
       - Valid Redirect URIs: 
         - https://prometheus.{{ (datasource "config").domain.primary }}/oauth2/callback
       - Web Origins: https://prometheus.{{ (datasource "config").domain.primary }}
    
    3. Configure client scopes:
       - Default Client Scopes: openid, email, profile
    
    4. Get the client secret from the Credentials tab
    
    5. Update the prometheus-oauth2-proxy secret with the actual client secret:
       kubectl edit secret prometheus-oauth2-proxy -n prometheus
    
    6. Generate a 32-character random cookie secret:
       openssl rand -base64 32 | head -c 32
       Update the cookie-secret in the same secret
    
    Note: OAuth2 Proxy will handle authentication and forward requests
    to Prometheus after successful Keycloak authentication.