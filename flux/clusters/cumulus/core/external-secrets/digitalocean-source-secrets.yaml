# Source secrets in central namespace that will be referenced by ExternalSecrets
# These are the actual secrets containing DigitalOcean credentials

---
# DigitalOcean API token for DNS and infrastructure
apiVersion: v1
kind: Secret
metadata:
  name: digitalocean-token
  namespace: digitalocean-secrets
  labels:
    app.kubernetes.io/name: digitalocean-secrets
    app.kubernetes.io/component: api-token
type: Opaque
stringData:
  # This will be set via environment variable in GitHub Actions
  token: "{{ .Env.DIGITALOCEAN_TOKEN }}"

---
# DigitalOcean Spaces credentials for backups and object storage
apiVersion: v1
kind: Secret
metadata:
  name: digitalocean-spaces
  namespace: digitalocean-secrets
  labels:
    app.kubernetes.io/name: digitalocean-secrets
    app.kubernetes.io/component: spaces-credentials
type: Opaque
stringData:
  # AWS-compatible credentials for DigitalOcean Spaces
  AWS_ACCESS_KEY_ID: "{{ .Env.DO_SPACES_ACCESS_KEY }}"
  AWS_SECRET_ACCESS_KEY: "{{ .Env.DO_SPACES_SECRET_KEY }}"
  # Alternative naming for different tools
  access_key: "{{ .Env.DO_SPACES_ACCESS_KEY }}"
  secret_key: "{{ .Env.DO_SPACES_SECRET_KEY }}"

---
# Sentry authentication token for error tracking
apiVersion: v1
kind: Secret
metadata:
  name: sentry-auth
  namespace: digitalocean-secrets
  labels:
    app.kubernetes.io/name: digitalocean-secrets
    app.kubernetes.io/component: sentry-auth
type: Opaque
stringData:
  token: "{{ .Env.SENTRY_AUTH_TOKEN }}"
  dsn: "{{ .Env.SENTRY_DSN }}"

---
# SMTP credentials for email notifications
apiVersion: v1
kind: Secret
metadata:
  name: smtp-credentials
  namespace: digitalocean-secrets
  labels:
    app.kubernetes.io/name: digitalocean-secrets
    app.kubernetes.io/component: smtp
type: Opaque
stringData:
  host: "{{ .Env.SMTP_HOST }}"
  port: "{{ .Env.SMTP_PORT }}"
  username: "{{ .Env.SMTP_USERNAME }}"
  password: "{{ .Env.SMTP_PASSWORD }}"
  from: "{{ .Env.SMTP_FROM }}"

---
# Database passwords for applications
apiVersion: v1
kind: Secret
metadata:
  name: database-passwords
  namespace: digitalocean-secrets
  labels:
    app.kubernetes.io/name: digitalocean-secrets
    app.kubernetes.io/component: database-credentials
type: Opaque
stringData:
  # Application database credentials
  keycloak-db-username: "keycloak"
  keycloak-db-password: "{{ .Env.KEYCLOAK_DB_PASSWORD }}"
  mattermost-db-username: "mattermost"
  mattermost-db-password: "{{ .Env.MATTERMOST_DB_PASSWORD }}"
  nextcloud-db-username: "nextcloud"
  nextcloud-db-password: "{{ .Env.NEXTCLOUD_DB_PASSWORD }}"
  mailu-db-username: "mailu"
  mailu-db-password: "{{ .Env.MAILU_PROD_DB_PASSWORD }}"
  postal-db-username: "postal"
  postal-db-password: "{{ .Env.POSTAL_DB_PASSWORD }}"
  sentry-db-username: "sentry"
  sentry-db-password: "{{ .Env.SENTRY_DB_PASSWORD }}"

---
# Admin passwords for applications
apiVersion: v1
kind: Secret
metadata:
  name: admin-passwords
  namespace: digitalocean-secrets
  labels:
    app.kubernetes.io/name: digitalocean-secrets
    app.kubernetes.io/component: admin-credentials
type: Opaque
stringData:
  keycloak-admin-password: "{{ .Env.KEYCLOAK_ADMIN_PASSWORD }}"
  nextcloud-admin-password: "{{ .Env.NEXTCLOUD_ADMIN_PASSWORD }}"

---
# OAuth2 and OIDC client secrets
apiVersion: v1
kind: Secret
metadata:
  name: oauth-credentials
  namespace: digitalocean-secrets
  labels:
    app.kubernetes.io/name: digitalocean-secrets
    app.kubernetes.io/component: oauth-credentials
type: Opaque
stringData:
  # Keycloak OAuth clients - client IDs
  mattermost-oauth-client-id: "{{ .Env.MATTERMOST_OAUTH_CLIENT_ID }}"
  nextcloud-oidc-client-id: "{{ .Env.NEXTCLOUD_OIDC_CLIENT_ID }}"
  mailu-oauth2-client-id: "{{ .Env.MAILU_OAUTH2_CLIENT_ID }}"
  grafana-oauth2-client-id: "{{ .Env.GRAFANA_OAUTH_CLIENT_ID }}"
  jaeger-oauth2-client-id: "{{ .Env.JAEGER_OAUTH_CLIENT_ID }}"
  prometheus-oauth2-client-id: "{{ .Env.PROMETHEUS_OAUTH_CLIENT_ID }}"
  sentry-oauth2-client-id: "{{ .Env.SENTRY_OAUTH2_CLIENT_ID }}"
  
  # Keycloak OAuth clients - client secrets
  mattermost-oauth-client-secret: "{{ .Env.MATTERMOST_OAUTH_CLIENT_SECRET }}"
  nextcloud-oidc-client-secret: "{{ .Env.NEXTCLOUD_OIDC_CLIENT_SECRET }}"
  mailu-oauth2-client-secret: "{{ .Env.MAILU_OAUTH2_CLIENT_SECRET }}"
  grafana-oauth2-client-secret: "{{ .Env.GRAFANA_OAUTH2_CLIENT_SECRET }}"
  jaeger-oauth2-client-secret: "{{ .Env.JAEGER_OAUTH2_CLIENT_SECRET }}"
  prometheus-oauth2-client-secret: "{{ .Env.PROMETHEUS_OAUTH2_CLIENT_SECRET }}"
  sentry-oauth2-client-secret: "{{ .Env.SENTRY_OAUTH2_CLIENT_SECRET }}"
  
  # OAuth2 proxy cookie secrets (generated)
  mattermost-cookie-secret: "{{ .Env.MATTERMOST_COOKIE_SECRET }}"
  nextcloud-cookie-secret: "{{ .Env.NEXTCLOUD_COOKIE_SECRET }}"
  mailu-cookie-secret: "{{ .Env.MAILU_COOKIE_SECRET }}"
  grafana-cookie-secret: "{{ .Env.GRAFANA_COOKIE_SECRET }}"
  jaeger-cookie-secret: "{{ .Env.JAEGER_COOKIE_SECRET }}"
  prometheus-cookie-secret: "{{ .Env.PROMETHEUS_COOKIE_SECRET }}"
  sentry-cookie-secret: "{{ .Env.SENTRY_COOKIE_SECRET }}"

---
# Redis credentials for caching and sessions  
apiVersion: v1
kind: Secret
metadata:
  name: redis-credentials
  namespace: digitalocean-secrets
  labels:
    app.kubernetes.io/name: digitalocean-secrets
    app.kubernetes.io/component: redis-credentials
type: Opaque
stringData:
  postal-redis-password: "{{ .Env.POSTAL_REDIS_PASSWORD }}"
  sentry-redis-password: "{{ .Env.SENTRY_REDIS_PASSWORD }}"

---
# Application-specific secrets
apiVersion: v1
kind: Secret
metadata:
  name: application-secrets
  namespace: digitalocean-secrets
  labels:
    app.kubernetes.io/name: digitalocean-secrets
    app.kubernetes.io/component: application-secrets
type: Opaque
stringData:
  # Postal application secrets
  postal-secret-key: "{{ .Env.POSTAL_SECRET_KEY }}"
  postal-rabbitmq-password: "{{ .Env.POSTAL_RABBITMQ_PASSWORD }}"
  
  # Nextcloud storage credentials
  nextcloud-spaces-access-key: "{{ .Env.NEXTCLOUD_SPACES_ACCESS_KEY }}"
  nextcloud-spaces-secret-key: "{{ .Env.NEXTCLOUD_SPACES_SECRET_KEY }}"
  
  # AWS SES credentials for email
  aws-ses-access-key-id: "{{ .Env.AWS_SES_ACCESS_KEY_ID }}"
  aws-ses-secret-access-key: "{{ .Env.AWS_SES_SECRET_ACCESS_KEY }}"
  ses-smtp-username: "{{ .Env.SES_SMTP_USERNAME }}"
  ses-smtp-password: "{{ .Env.SES_SMTP_PASSWORD }}"