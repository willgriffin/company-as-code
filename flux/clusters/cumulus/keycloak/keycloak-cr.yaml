apiVersion: k8s.keycloak.org/v2alpha1
kind: Keycloak
metadata:
  name: keycloak
  namespace: keycloak
spec:
  instances: 1
  image: quay.io/keycloak/keycloak:26.0.7
  hostname:
    hostname: auth.happyvertical.com
    strict: false
  http:
    httpEnabled: true
    httpPort: 8080
    httpsPort: 8443
  proxy:
    headers: xforwarded
  features:
    enabled:
      - authorization
      - account3
      - admin-api
      - client-policies
  db:
    vendor: postgres
    host: keycloak-pg-rw
    port: 5432
    database: keycloak
    usernameSecret:
      name: keycloak-pg-app
      key: username
    passwordSecret:
      name: keycloak-pg-app
      key: password
  ingress:
    enabled: false  # We'll use our existing Traefik ingress
  unsupported:
    podTemplate:
      spec:
        containers:
          - resources:
              requests:
                cpu: 500m
                memory: 512Mi
              limits:
                cpu: 1000m
                memory: 1Gi