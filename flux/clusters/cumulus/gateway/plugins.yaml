# Kong plugins for DB-less mode (per-service configuration)
# Note: In DB-less mode, global plugins are defined per-service via annotations

---
# Prometheus metrics plugin (per-service)
apiVersion: configuration.konghq.com/v1
kind: KongClusterPlugin
metadata:
  name: prometheus-metrics
config:
  per_consumer: false
  status_code_metrics: true
  latency_metrics: true
  bandwidth_metrics: true
  upstream_health_metrics: true
plugin: prometheus

---
# OpenTelemetry tracing plugin (per-service)
apiVersion: configuration.konghq.com/v1
kind: KongClusterPlugin
metadata:
  name: opentelemetry-tracing
config:
  endpoint: http://opentelemetry-collector.opentelemetry-operator-system.svc.cluster.local:4318/v1/traces
  headers:
    x-service-name: kong-gateway
  resource_attributes:
    service.name: kong-gateway
    service.version: "3.0"
  batch_span_processor:
    max_queue_size: 2048
    batch_timeout: 1
    max_batch_size: 256
plugin: opentelemetry

---
# Basic rate limiting plugin (local, no Redis dependency)
apiVersion: configuration.konghq.com/v1
kind: KongClusterPlugin
metadata:
  name: basic-rate-limit
config:
  minute: 1000
  hour: 10000
  day: 100000
  limit_by: ip
  policy: local
  hide_client_headers: false
plugin: rate-limiting

---
# Request size limiting plugin
apiVersion: configuration.konghq.com/v1
kind: KongClusterPlugin
metadata:
  name: request-size-limit
config:
  allowed_payload_size: 128
  size_unit: megabytes
  require_content_length: false
plugin: request-size-limiting