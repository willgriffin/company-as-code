# Secret template for Nextcloud
# This file is processed by GitHub Actions to generate encrypted secrets
# Required GitHub Secrets:
# - NEXTCLOUD_PROD_DB_PASSWORD
# - NEXTCLOUD_PROD_ADMIN_PASSWORD
# - NEXTCLOUD_PROD_OIDC_CLIENT_ID
# - NEXTCLOUD_PROD_OIDC_CLIENT_SECRET
# - NEXTCLOUD_PROD_SPACES_ACCESS_KEY
# - NEXTCLOUD_PROD_SPACES_SECRET_KEY
# - BACKUP_SPACES_ACCESS_KEY
# - BACKUP_SPACES_SECRET_KEY

apiVersion: v1
kind: Secret
metadata:
  name: nextcloud-pg-app
  namespace: nextcloud
type: kubernetes.io/basic-auth
stringData:
  username: nextcloud
  password: "{{ .Env.NEXTCLOUD_DB_PASSWORD }}"
---
apiVersion: v1
kind: Secret
metadata:
  name: nextcloud-oidc
  namespace: nextcloud
type: Opaque
stringData:
  client-id: "{{ .Env.NEXTCLOUD_OIDC_CLIENT_ID }}"
  client-secret: "{{ .Env.NEXTCLOUD_OIDC_CLIENT_SECRET }}"
---
apiVersion: v1
kind: Secret
metadata:
  name: nextcloud-spaces
  namespace: nextcloud
type: Opaque
stringData:
  access-key: "{{ .Env.NEXTCLOUD_SPACES_ACCESS_KEY }}"
  secret-key: "{{ .Env.NEXTCLOUD_SPACES_SECRET_KEY }}"
---
apiVersion: v1
kind: Secret
metadata:
  name: nextcloud-admin
  namespace: nextcloud
type: Opaque
stringData:
  password: "{{ .Env.NEXTCLOUD_ADMIN_PASSWORD }}"
---
# Backup credentials for PostgreSQL (DigitalOcean Spaces)
apiVersion: v1
kind: Secret
metadata:
  name: nextcloud-postgres-backup-credentials
  namespace: nextcloud
type: Opaque
stringData:
  ACCESS_KEY_ID: "{{ .Env.BACKUP_SPACES_ACCESS_KEY }}"
  SECRET_ACCESS_KEY: "{{ .Env.BACKUP_SPACES_SECRET_KEY }}"