apiVersion: v1
kind: ConfigMap
metadata:
  name: postal-config
  namespace: postal
data:
  postal.yml: |
    general:
      use_ip_pools: false
    
    web_server:
      bind_address: 0.0.0.0
      port: 5000
    
    smtp_server:
      port: 25
      bind_address: 0.0.0.0
      tls_enabled: true
      tls_certificate_path: ""
      tls_private_key_path: ""
      proxy_protocol: false
      log_connections: true
      strip_received_headers: false
    
    rails:
      environment: production
      log_level: info
    
    main_db:
      host: postal-db-rw.postal.svc.cluster.local
      username: postal
      password: "{{ .Values.database.password }}"
      database: postal
    
    message_db:
      host: postal-db-rw.postal.svc.cluster.local
      username: postal
      password: "{{ .Values.database.password }}"
      database: postal
      prefix: postal
    
    redis:
      host: rfs-postal-redis.postal.svc.cluster.local
      port: 6379
      password: "{{ .Values.redis.password }}"
      db: 0
    
    # Mail forwarding configuration
    mail_forwarding:
      enabled: true
      default_forward_to: "mailu-front.mailu.svc.cluster.local:25"
      forward_headers:
        - "X-Original-To"
        - "X-Forwarded-From"
        - "X-Postal-Server"
    
    # Webhook configuration for processing
    webhooks:
      enabled: true
      endpoints:
        - name: "mailu_forwarder"
          url: "http://postal-forwarder.postal.svc.cluster.local:8080/webhook"
          events: ["MessageReceived"]
          enabled: true