apiVersion: databases.spotahome.com/v1
kind: RedisFailover
metadata:
  name: mailu-redis
  namespace: mailu
spec:
  sentinel:
    replicas: 3
    resources:
      requests:
        cpu: "50m"
        memory: "64Mi"
      limits:
        cpu: "100m"
        memory: "128Mi"
  redis:
    replicas: 1  # Start with single instance, can scale for HA
    resources:
      requests:
        cpu: "50m"
        memory: "128Mi"
      limits:
        cpu: "200m"
        memory: "256Mi"
    storage:
      size: "2Gi"
      storageClassName: "do-block-storage"
    customConfig:
      - "maxmemory-policy allkeys-lru"
      - "save 900 1"      # Save after 900 seconds if at least 1 key changed
      - "save 300 10"     # Save after 300 seconds if at least 10 keys changed
      - "save 60 10000"   # Save after 60 seconds if at least 10000 keys changed